!pip install PyTelegramBotAPI==3.6.7
!pip install selenium
!pip install time
!pip install config
import telebot
from telebot import types
from selenium import webdriver
from time import sleep
from selenium.webdriver.common.by import By
import config
driver = webdriver.Chrome(r"C:\Users\lina-\tlg\chromedriver.exe")
bot = telebot.TeleBot("2059143566:AAFLrUMVBY-wgMEccUpNkdiy8HqMuShddVE")
@bot.message_handler(commands=['start'])
def start (message):
    bot.send_message(message.chat.id,'Привет!. Ты можешь использовать следующие команды: /nearest - даст ссылку на твой запрос, /best - выведет топ 3 фильма по запрашиваемой категории, /shedule - покажет, какие фильмы сейчас в прокате',reply_markup=markupstart)

#keyboard for start
markupstart=types.ReplyKeyboardMarkup(resize_keyboard=True)
item1=types.KeyboardButton("/nearest")    
item2=types.KeyboardButton("/best")
item3=types.KeyboardButton("/shedule")
markupstart.add(item1,item2,item3)    
#keyboard for best
markup=types.ReplyKeyboardMarkup(resize_keyboard=True)
item1=types.KeyboardButton("history")
item2=types.KeyboardButton("anime")
item3=types.KeyboardButton("action")
item4=types.KeyboardButton("romance")
item5=types.KeyboardButton("mystery")
item6=types.KeyboardButton("comedy")
markup.add(item1,item2,item3,item4,item5,item6)
    
@bot.message_handler(commands=['nearest'])   
def nearest(message):
    msg=bot.send_message(message.chat.id,'Введите название фильма, который вы хотите посмотреть')
    bot.register_next_step_handler(msg,search)
    
@bot.message_handler(commands=['best'])
def best (message):
    bst=bot.send_message(message.chat.id,'Выберите категорию',reply_markup=markup)
    bot.register_next_step_handler(bst,poisk)
    
@bot.message_handler(commands=['shedule'])
def shedule(message):
    bot.send_message(message.chat.id,"Вот фильмы в прокате на сегодня, секунду")
    afisha="https://www.kinopoisk.ru/afisha/new/city/1/" 
    driver.get(afisha)
    sleep(2)
    shedule=driver.find_elements(By.CLASS_NAME,"name [href]")
    for i in range (len(shedule)):
            bot.send_message(message.chat.id,shedule[i].get_attribute('text'))
            if i==3:
                break

@bot.message_handler(content_types=['text'])
def text(message):
    bot.send_message(message.chat.id,"Что-то хотел?")
def search(message):
    bot.send_message(message.chat.id,"Начинаю поиск")
    film_href="https://www.kinopoisk.ru/s/type/film/list/1/find/ " +  message.text
    driver.get(film_href)
    sleep(2)
    films=driver.find_elements(By.CLASS_NAME,"pic [href]")
    for i in range (len(films)):
            bot.send_message(message.chat.id,films[i].get_attribute('href'))
            if i==4:
                break                                           
def poisk(message):
    bot.send_message(message.chat.id,"Начинаю поиск")
    film_href="https://www.kinopoisk.ru/lists/top500/" +  message.text
    driver.get(film_href)
    sleep(2)
    films=driver.find_elements(By.CLASS_NAME,"selection-film-item-meta__name")
    for i in range (len(films)):
            bot.send_message(message.chat.id,films[i].get_attribute('textContent'))
            if i==2:
                break                                           
                
bot.polling(none_stop = True)
